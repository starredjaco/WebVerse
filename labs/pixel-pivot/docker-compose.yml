services:
  proxy:
    image: nginx:1.27-alpine
    container_name: apv_pixel_pivot_proxy
    ports:
      - "80:80"
    volumes:
      - ./proxy/nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - web
      - chat
      - gitea
      - internal_api
    networks:
      - apvnet

  web:
    build: ./web
    container_name: apv_pixel_pivot_web
    environment:
      - DB_PATH=/data/web.db
      - APP_DOMAIN=ubihard.local
    volumes:
      - web_data:/data
    networks:
      - apvnet

  chat:
    build: ./chat
    container_name: apv_pixel_pivot_chat
    environment:
      - DB_PATH=/data/chat.db
    volumes:
      - chat_data:/data
    networks:
      - apvnet

  gitea:
    build: ./gitea
    container_name: apv_pixel_pivot_gitea
    environment:
      - DB_PATH=/data/gitea.db
      - INTERNAL_API_KEY=APV_INTERNAL_6d7f9c2b4b
      - INTERNAL_API_BASE=http://internal-api.ubihard.local
    volumes:
      - gitea_data:/data
    networks:
      - apvnet

  internal_api:
    build: ./internal_api
    container_name: apv_pixel_pivot_internal_api
    environment:
      - INTERNAL_API_KEY=APV_INTERNAL_6d7f9c2b4b
    networks:
      - apvnet

networks:
  apvnet:

volumes:
  web_data:
  chat_data:
  gitea_data:
  internal_api_data:
